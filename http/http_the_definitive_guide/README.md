# 第一章  HTTP概述  
在这一章我们可以看到如下内容： 
- web客户端鱼服务器是如何通信的   
- 资源来自何方  
- web事物是怎样工作的      
- HTTP通信所使用的报文格式  
- 底层TCP网络传输   
- 不同的HTTP协议变体   
- 因特网上安装的大量HTTP架构组件中的一部分  
1. HTTP-因特网的多媒体信使   
HTTP使用的是可靠的数据传输协议，即使数据来自地球的另一端，它也能够确保数据在传输的过程中不会被损坏或产生混乱，无需担心HTTP通信会在传输过程中中国年被破坏，复制后产生畸变    
2. web客户端和服务器   
客户端向服务器发送HTTP请求，服务器会在HTTP响应中会送所请求的数据，http客户端和http服务器共同构成万维网的基本组件   
浏览一个页面时(http://www.oreilly.com/index.html)，浏览器会向服务器(www.oreilly.com)发送一条http请求,服务器会去寻找所期望的对象(/index.html),如果成功，就将对象，对象类型，对象长队以及其他一些信息放在http相应中发送给客户端   
3. 资源   
web服务器就是web资源的宿主，web资源是web内容的源头。最简单的web资源就是web服务器文件系统中的静态文件，这些文件包含人以内容：文本文件，html文件，微软的word文件，adobe的acrobat文件，jpeg图片文件，avi电影文件等。    
但是资源不一定非得是静态文件，资源还可以是根据需要生成内容的软件程序   
- 媒体类型   
http给每种要通过web传输的对象都打上名为**MIME类型**的数据格式标签。当web浏览器从服务器中取回一个对象是，会去查看相关的MIME类型，看看它是否知道应该如何处理这个对象。    
MIME类型是一种文本标记，表示为(主要的对象类型/特定的子类型)，比如：    
- HTML格式的文本文档：text/html
- 普通的ASCII文本文档：text/plain
- jpeg格式的图片：image/jpeg    
- gif格式的图片：image/gif    
- Apple的QuickTime电影：video/quicktime    
- 微软的PowerPoint演示文件：application/vnd.ms-powerpoint  
常见的MIME类型有数百个     
- URI 统一资源标识符   
每个web服务器资源都有一个名字，被称为URI(Uniform Resource Identifier).它就像邮政地址一样，在世界范围内唯一标示并定位信息资源。给定了URI，http就可以解析出对象，URI有两种形式：URL和URN  
- URL  统一资源定位符   
URL表述了一台特定服务器上某资源的特定位置   
大部分URL都遵循一种标准格式，包括三个部分：  
- 方案(scheme)，说明了访问资源所使用的协议类型(http://)   
- 服务器的因特网地址(www.baidu.com)   
- 其余部分指定web服务器上的某个资源    
现在几乎所有的URI都是URL    
- URN  统一资源名   
座位特定内容的唯一名称使用，与目前的资源所在地无关，可以将资源四处搬移，URN仍然处于试验阶段，并未大范围使用   
4. 事务   
一个http事务包括一个请求命令和一个相应结果，这种通信通过名为http报文的格式化数据块进行的    
- 方法    
http支持集中不同的请求命令，被称为http方法。每条请求报文都包含一个方法，这个方法告诉服务器执行什么动作(获取一个web页面，运行一个网关程序，删除一个文件)，以下是5中常见的方法：    
1. GET：从服务器向客户端发送命名资源   
2. PUT：将来自客户端的数据存储到一个命名的服务器资源中   
3. DELETE：从服务器删除命名资源   
4. POST：将客户端数据发送到一个服务器网关应用程序   
5. HEAD：仅发送命名资源相应中的http首部   
- 状态码   
每条http响应报文返回时都会携带一个状态码，由三位数字组成，告诉客户端请求是否成功，或者是否需要采取其他动作，下面是常见的状态码：   
1. 200:OK，文档正确返回   
2. 302:Redirect(重定向)，到其他地方去获取资源   
3. 404:Not Found(没找到)，无法找到这个资源   
- web页面中可包含多个对象    
一个web页面的获取可能需要多个http事务，比如一个事务获取描述页面布局的html"框架"，其他的事务分别获取嵌入式图片，图像面板，java小程序等。一个web页面通常不是单个资源，而是一组资源的集合，可能分布在不同的服务器上   
5. 报文   
http报文都是纯文本，不是二进制代码，包括请求报文和相应报文，http报文包括以下三部分：   
- 起始行    
报文第一行就是起始行，在请求报文中用来说明要做些什么，在相应报文中说明出现了什么情况   
- 首部字段   
起始行后面有零个或多个首部字段，每个首部字段包含(名字：值)，以一个空行结束   
- 主体   
空行之后就是可选的报文主体了，其中包含了所有类型的数据。请求主体中包括了要发送个web服务器的数据，相应主体中国年装载了要返回给客户端的数据。主体中可以包含任意二进制数据(比如图片，视频，音轨，软件程序)     
6. 连接   
报文是如何通过传输控制协议(TCP)连接从一个地方搬移到另一个地方   
- TCP/IP    
http是应用层协议，无需操心网络通信的具体细节，把联网的细节都交给了通用，可靠的因特网传输协议TCP/IP   
TCP提供了：   
- 无差错的数据传输  
- 按序传输    
- 未分段的数据流(以任意尺寸将数据发送出去)   
     
- 连接，IP地址及端口号  
在http客户端向服务器发送报文之前，需要用ip地址和端口号在客户端和服务器之间建立一条TCP连接。步骤如下：   
a. 浏览器从URL中国年解析出服务器主机名   
b. 浏览器将服务器主机名转换为服务器IP地址(DNS服务器)   
c. 浏览器将服务器端口号(如果有的话)从URL中解析出来  
d. 浏览器建立一条与web服务器的tcp连接    
e. 浏览器向服务器发送一条http请求报文   
f. 服务器向浏览器回送一条http响应报文   
g. 关闭连接，浏览器显示文档   
7. 协议版本   
- http/0.9    
- http/1.0   
- http/1.0+   
- http/1.1    
- http/2.0    
8. web的结构组件   
- 代理   
http代理服务器是web安全，应用集成以及性能优化的重要组成模块。
代理位于客户端与服务器之间，接收所有客户端的http请求，并将这些请求转发给服务器(可能会对请求进行修改后转发)     
- 缓存   
web缓存或代理缓存是一种特殊的http代理服务器，可以将经过代理传送的常用文档复制保存起来，客户端从附近的缓存下载文档比远程服务器下载快得多
- 网关    
网关是一种特殊的服务器，作为其他服务器的中间实体使用，通常用于将http流量转换成其他的协议
- 隧道  
隧道是建立以后，就会在两条连接之间对原始数据进行盲转发的http应用程序。http隧道通常用来在一条或多条http连接上转发菲http数据
- Agent代理   
用户Agent代理是代表用户发起http请求的客户端程序。所有发布web请求的应用程序都是httpAgent代理，不仅仅包括web浏览器，还有其他类型
发起自动http请求的半智能web客户端   

 # 第二章  URL与资源   
本章将介绍：    
- URL语法，以及各种URL组件的含义及其所做的工作  
- 很多web客户端都支持的URL快捷方式，包括相对URL和自动扩展URL 
- URL编码和字符规范   
- 支持各种因特网信息系统的常见URL方案  
- URL的未来   
1. 浏览因特网资源  
大多数URL都有同样的：“方案://服务器位置/路径“结构    
URL未用户以及他们的浏览器提供了找到信息所需的所有条件，URL定义了用户所需的特定资源，它位于何处以及如何获取它     
2. URL的语法   
URL随着方案的不同而有所不同   
URL的通用格式如下    
```
<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<frag>  
```   
- 方案   
方案告诉负责解析URL的应用程序应该使用什么协议，用冒号与其它部分分隔，大小写无关的    
- 主机与端口   
主机组件标示了因特网上能够访问资源的宿主机器(主机名或IP地址)，端口组件标示了服务器正在监听的网络端口，对下层使用了TCP协议的http来说，默认端口是80    
- 用户名和密码   
很多服务器都要求输入用户名和密码才会允许用户访问数据，ftp服务器就是这样   
```    
ftp://anonymous:my_passwd@ftp.prep.ai.mit.edu/pub/gnu    
```    
- 路径   
路径组件说明了资源位于服务器的什么地方，通常很像一个分级的文件系统路径     
- 参数   
为了向应用程序提供它们所需的输入参数，以便正确的与服务器进行交互，URL中有一个参数组件，它们为应用程序提供了访问资源所需的附加信息   
```
ftp://prep.ai.mit.edu/pub/gnu;tpye=d
```
路径组件可以分为若干路径段，每段都可以有自己的参数    
```
http://www.joes-hardware.com/hammers;sale=false/index.html;graphics=true
```
- 查询字符串    
很多资源，比如数据库服务，都是可以通过提问题或进行查询来缩小所请求资源类型范围的    
```
http://www.joes-hardware.com/inventory-check.cgi?item=12731
```
？右边的是查询组件，URL的查询组件和标示网关资源的URL路径组件一起别发送给网关资源     
- 片段   
为了引用部分资源或资源的一个片段，片段组件表示一个资源内部的片段。http服务器通常只处理整个对象，浏览器从服务器获得整个资源之后，会根据片段来显示你感兴趣的那部分资源   
```
http://www.joes-hardware.com/tools.html#drills
```
3. URL快捷方式   
web客户端可以理解并使用几种URL快捷方式，包括相对URL和URL的自动扩展   
- 相对URL    
URL有两种方式：绝对的和相对的。绝对URL包含访问资源所需的全部信息    
相对URL是不完整的，要从相对URL中获取访问资源的全部信息，就必须相对于一个被称为基础的URL进行解析   
相对URL是URL的一种便捷缩略记法     
相对URL为保持一组资源的便捷性提供了一种便捷的方式，可以在半一一组文件的同时，仍然保持链接的有效性   
由相对URL转换到绝对URL的第一步就是找到基础URL，基础URL由三种方式：    
- 在资源中显示提供    
有些资源会显示指定基础URL，比如HTML文档中可能包含了一个定义了基础URL的HTML标记<BASE>      
- 封装资源的基础URL   
没有显示指定基础URL，可以将该资源的URL作为基础    
- 没有基础URL   
这通常意味着有一个相对URL，但有时可能是一个不完整或损坏的URL 
         
- 自动扩展URL     
用户不需要输入完整的URL，浏览器会自动扩展   
这些扩展有两种方式：   
- 主机名扩展   
只要一些小提示，浏览器就可以将我们输入的主机名扩展为完整的主机名     
- 历史扩展   
将以前用户访问过的URL历史保存起来，当我们输入URL是，将输入URL与历史记录中的URL的前缀进行匹配，并提供一些完整的选项供我们选择       
4. 各种令人头疼的字符   
URL是可移植的，能被因特网任意协议安全传输，而且是可读的，完整的    
- URL字符集   
ASCII和转义序列     
- 编码机制  
通过“转义”表示法来表示不安全的字符，包含一个百分号(%)，后面跟着两个表示字符的ASCII码的十六进制，例如：  
- ～    0x7E     `http://www.joes-hardware.com/%7Ejoe`    
- 空格  0x20     `http://www.joes-hardware.com/more%20tools.html`     
- %     0x25     `http://www.joes-hardware.com/100%25satisfaction.html`     
     
- 字符限制   
在URL中，有几个字符被保留起来，有着特殊的含义    
5. 方案   
- http     
超文本传输协议方案，没有用户名和密码，默认端口是80    
- https   
与http唯一的区别在于https使用了网景的SSL，提供了端到端的加密机制，默认端口是443    
- mailto    
mailto URL指向的是E-mail地址     
- ftp    
文件传送协议URL可以从ftp服务器上下载或向其上载文件   
- rtsp，rtspu    
RTSP URL是可以通过实时流传输协议解析的音/视频媒体资源的标识符      
- file   
方案file表示一台指定主机上可直接访问的文件    
- news    
方案news用来访问一些特定的文章或新闻组   
- telnet   
方案telnet用于访问交互式业务   
 
# 第三章  HTTP报文   
本章将介绍：   
- 报文是如何流动的    
- HTTP报文的三个组成部分   
- 请求和相应报文之间的的区别   
- 请求报文支持的各种功能   
- 和响应报文一起返回的各种状态码   
- 各种各样的HTTP首部都是用来做什么的   
1. 报文流  
报文在客户端，服务器和代理之间流动，术语“流入”，“流出”，“上游”，“下游”都是用来描述报文方向的    
- 报文流入源端服务器    
http使用术语“流入”和“流出”来描述事务处理的方向。报文流入源端服务器，工作完成之后，会流回用户的Agent代理中    
- 报文向下游流动   
所有报文的发送者都是接收者的上游，不管是请求报文还是响应报文，所有报文都会向下游流动    
2. 报文的组成部分   
报文包含三部分：   
- 起始行，对报文进行描述   
- 首部，包含属性  
- 主体，可选的包含数据   
起始行和首部是由行分隔的ASCII文本，每行以一个回车符+一个换行符作为结束    
- 报文的语法   
请求报文的格式为：   
```
<method> <request-URL> <version>     
<headers>    
     
<entity-body>   
```
响应报文的格式为：   
```
<version> <status> <reason-phrase>  
<headers>   
    
<entity-body>   
```   
下面对各部分进行简要说明：   
- 方法   
客户端希望服务器对资源执行的动作，是一个单一的词  
- 请求URL   
命名了所请求的资源   
- 版本   
报文所使用的HTTP版本，格式为`HTTP/<major>.<minor>`    
- 状态码   
三位数字描述了请求过程中所发生的情况   
- 原因短语   
数字状态码的可读版本，包含行终止序列之前的所有文本   
- 首部   
可以有零个或多个首部，(名字：值)    
- 实体的主体部分  
由任意数据组成的数据块     
3. 方法    
HTTP定义了一组被称为安全方法的方法，GET和HEAD方法都是安全的，因为它们不会在服务器上产生结果
下面是常用的一些方法：   
- GET  从服务器获取一份文档   不包含主体   
- HEAD 只从服务器获取文档的首部 不包含主体  
使用HEAD，可以：   
a. 在不获取资源的情况下了解资源的情况(判断其类型)    
b. 通过查看响应中的状态码，看看某个对象是否存在     
c. 通过查看首部，测试资源是否被修改    
- POST 向服务器发送需要处理的数据  包含主体     
POST方法起初是用来向服务器输入数据的，实际上会用它来支持HTML的表单。表单中填好的数据通常被送给服务器，然后由服务器将其发送到他要去的地方    
- PUT 将请求的主体部分存储到服务器上  包含主体     
PUT方法的语义就是让服务器用请求的主体部分来创建一个有所请求的URL命名的新文档，如果那个URL已经存在的话，就用这个主体来替代它       
- TARCE 对可能经过代理服务器传送到服务器上去的报文进行跟踪 不包含主体     
一个请求可能经过多个中间节点，每个中间节点都会修改原始的http请求。TRACE方法允许客户端在最终将请求发送给服务器时，看看它变成了什么样子。     
TRACE请求会在目的服务器端发起一个“换回”诊断，行程最后一站的服务器会弹回一条TRACE响应，并在响应主题中携带它受到的原始请求报文，这样客户端就可以查看原始报文是如何被修改的    
TRACE方法主要用于诊断，也是一种很好的工具，可以用来查看代理和其他应用程序对用户请求所产生的效果  
- OPTONS 决定可以在服务器上执行哪些方法   不包含主体    
OPTION方法请求web服务器告知其支持的各种功能，可以询问服务器通常支持哪些方法，或者对某些特殊的资源支持哪些方法
- DELETE 从服务器上删除一份文档     
DELETE方法所做的事情就是请服务器删除请求URL所制定的资源，但是客户端应用程序无法保证删除操作一定会被执行，因为http规范允许服务器在不通知客户端的情况下撤销请求    
并不是所有的服务器都可以实现以上方法，其它服务器可能有自己的方法，被称为扩展方法     
web发布扩展方法示例：   
- LOCK 允许用户锁定资源(编辑某个资源时，将其锁定，以防别人同时对其进行修改)    
- MKCOL  允许用户创建资源  
- COPY  便于在服务器上复制资源   
- MOVE 在服务器上移动资源    
4. 状态码     
http状态码分成了5大类      
状态码分类：   
- 100-199   信息性状态码   
   
- 200-299     200-206    成功   
- 300-399     300-305    重定向    
- 400-499     400-415    客户端错误   
- 500-599     500-505    服务器错误   
http中可以分为以下几类首部：   
- 通用首部   
既可以出现在请求报文中，也可以出现在响应报文中   
- 请求首部   
提供更多有关请求的信息     
- 响应首部  
提供更多有关响应的首部  
- 实体首部  
描述主体的长度和内容，或者资源本身  
- 扩展首部  
规范中没有定义的新首部  
常见的首部实例：   
- `Date:Tue 3Oct 2016 02:16:03 GMT`  服务器产生响应的日期  
- `Content-length:12240`   实体的主体部分包含了12240字节的数据   
- `Content-type:image/gif`  实体的主体部分是一个GIF图片  
- `Accept:image/gif,image/jpeg,text/html`  客户端可以接收的格式   
将长的首部分为多行可以提高可读性，多出来的每行前面至少有一个空格或制表符     
   

  
 
